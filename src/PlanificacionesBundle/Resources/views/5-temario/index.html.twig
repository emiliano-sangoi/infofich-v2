{% set page_id = 5 %}

{% extends "PlanificacionesBundle::planif-base.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        td:hover{
            cursor:move;
        }
    </style>
{% endblock %}

{% block tab_content %}

    <div class="mb-4">
        {% embed "::botonera-2col.html.twig" %}
            {% block left %}
                <a href="{{ path('planif_temario_nuevo', { id: planificacion.id }) }}" class="btn btn-success">
                    Nuevo tema
                </a>
            {% endblock %}
        {% endembed %}
    </div>

    {% if planificacion.temario[0] is not defined %}
        {% from '::macros.html.twig' import notificacion %}
        {% set msg %}
            <span class="text-muted">No se ha cargado contenido en esta secci&oacute;n.</span>
        {% endset %}
        {{ notificacion(null, msg, 'secondary', '' ) }}
    {% else %}
        {% include "PlanificacionesBundle:5-temario:tabla-temario.html.twig" %}
    {% endif %}

{% endblock %} 


{% block javascripts %}
    {{ parent() }}

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="{{ asset('node_modules/jquery-ui-dist/jquery-ui.min.js') }}"></script>

    {% if planificacion.puedeEditarse() %}
        <script>

            $(document).ready(function () {

                var fixHelperModified = function (e, tr) {
                        var $originals = tr.children();
                        var $helper = tr.clone();
                        $helper.children().each(function (index) {
                            $(this).width($originals.eq(index).width())
                        });
                        return $helper;
                    },
                    updateIndex = function (e, ui) {
                        $('td.posicion', ui.item.parent()).each(function (i) {
                            $(this).html(i + 1);
                        });
                        $('td.unidad', ui.item.parent()).each(function (i) {
                            //$(this).val(i + 1);
                            $(this).html(i + 1);
                        });
                    };

                $("#tablaTemario tbody").sortable({
                    helper: fixHelperModified,
                    stop: updateIndex
                }).disableSelection();

                $("tbody").sortable({
                    distance: 5,
                    delay: 100,
                    opacity: 0.6,
                    cursor: 'move',
                    update: function () {
                    }
                });


            });
        </script>
    {% endif %}




{% endblock %} 